<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <url value="https://fhir.nhs.uk/R4/StructureDefinition/MM-MedicationRequest" />
  <name value="MM-MedicationRequest" />
  <status value="draft" />
  <fhirVersion value="4.0.1" />
  <mapping>
    <identity value="workflow" />
    <uri value="http://hl7.org/fhir/workflow" />
    <name value="Workflow Pattern" />
  </mapping>
  <mapping>
    <identity value="script10.6" />
    <uri value="http://ncpdp.org/SCRIPT10_6" />
    <name value="Mapping to NCPDP SCRIPT 10.6" />
  </mapping>
  <mapping>
    <identity value="rim" />
    <uri value="http://hl7.org/v3" />
    <name value="RIM Mapping" />
  </mapping>
  <mapping>
    <identity value="w5" />
    <uri value="http://hl7.org/fhir/fivews" />
    <name value="FiveWs Pattern Mapping" />
  </mapping>
  <mapping>
    <identity value="v2" />
    <uri value="http://hl7.org/v2" />
    <name value="HL7 v2 Mapping" />
  </mapping>
  <kind value="resource" />
  <abstract value="false" />
  <type value="MedicationRequest" />
  <baseDefinition value="https://fhir.nhs.uk/R4/StructureDefinition/UKCore-MedicationRequest" />
  <derivation value="constraint" />
  <differential>
    <element id="MedicationRequest.id">
      <path value="MedicationRequest.id" />
      <comment value="ITK Mapping = pertinentInformation2[0].pertinentLineItem.id" />
    </element>
    <element id="MedicationRequest.extension">
      <path value="MedicationRequest.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
    </element>
    <element id="MedicationRequest.extension:eps-prescriptionType">
      <path value="MedicationRequest.extension" />
      <sliceName value="eps-prescriptionType" />
      <short value="ITK Prescription Type" />
      <comment value="Type of prescription, possibly can be moved to category." />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/R4/StructureDefinition/Extension-eps-prescriptionType" />
      </type>
    </element>
    <element id="MedicationRequest.extension:procedureCode">
      <path value="MedicationRequest.extension" />
      <sliceName value="procedureCode" />
      <min value="1" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/R4/StructureDefinition/Extension-procedureCode" />
      </type>
    </element>
    <element id="MedicationRequest.extension:tokenIssued">
      <path value="MedicationRequest.extension" />
      <sliceName value="tokenIssued" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/R4/StructureDefinition/Extension-tokenIssued" />
      </type>
    </element>
    <element id="MedicationRequest.medication[x]">
      <path value="MedicationRequest.medication[x]" />
      <comment value="Any code from the SnomedCT UK subset that describes a manufactured material (e.g. a pharmaceutical product or personal medical device).  These wil form part of the NHS DM&amp;D Dictionary.&#xD;&#xA;&#xD;&#xA;ITK HL7v3 Mapping = ParentPrescription.pertinentInformation2.pertinentLineItem.product.manufacturedProduct.manufacturedRequestedMaterial" />
      <type>
        <code value="CodeableConcept" />
      </type>
    </element>
    <element id="MedicationRequest.medication[x].coding">
      <path value="MedicationRequest.medication[x].coding" />
      <min value="1" />
      <binding>
        <strength value="required" />
        <description value="ManufacturedMaterialSnCT" />
        <valueSet value="https://fhir.nhs.uk/R4/ValueSet/CareConnect-ManufacturedMaterialSnCT" />
      </binding>
    </element>
    <element id="MedicationRequest.authoredOn">
      <path value="MedicationRequest.authoredOn" />
      <comment value="ITK Mapping = ParentPrescription.effectiveTime" />
    </element>
    <element id="MedicationRequest.requester">
      <path value="MedicationRequest.requester" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.requester.identifier">
      <path value="MedicationRequest.requester.identifier" />
      <comment value="Should consider making identifier (GMP, GMC,etc) Code mandatory." />
    </element>
    <element id="MedicationRequest.requester.display">
      <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-translatable">
        <valueBoolean value="true" />
      </extension>
      <path value="MedicationRequest.requester.display" />
      <comment value="The name of the of the issuer must be included in the MedicationRequest (this is for legal reasons)" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.performerType">
      <path value="MedicationRequest.performerType" />
      <comment value="If specified without indicating a performer, this indicates that the performer must be of the specified type. If specified with a performer then it indicates the requirements of the performer if the designated performer is not available.&#xD;&#xA;&#xD;&#xA;EPS - This has several similarities to the dispensing-site-preference codeSystem. Should this be moved here from an extension and also switched to SNOMED." />
    </element>
    <element id="MedicationRequest.groupIdentifier">
      <path value="MedicationRequest.groupIdentifier" />
      <short value="Composite request this is part of." />
      <comment value="ITK HL7v3 Mapping = The groupIdentifier is equivalent to ParentPrescription.id (prescription-short-form). The extension is used to carry the ParentPrescription.id (UUID)." />
      <min value="1" />
    </element>
    <element id="MedicationRequest.groupIdentifier.extension">
      <path value="MedicationRequest.groupIdentifier.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
    </element>
    <element id="MedicationRequest.groupIdentifier.extension:eps-parentPrescriptionId">
      <path value="MedicationRequest.groupIdentifier.extension" />
      <sliceName value="eps-parentPrescriptionId" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/R4/StructureDefinition/Extension-eps-parentPrescriptionId" />
      </type>
    </element>
    <element id="MedicationRequest.courseOfTherapyType">
      <path value="MedicationRequest.courseOfTherapyType" />
      <comment value="The type of prescription e.g. acute, repeat, repeat-dispensing. Note, EPS uses a subset of the PrescriptionType subset and excludes non ETP items (e.g. handwritten).&#xD;&#xA;ITK Mapping = pertinentInformation5.pertinentPrescriptionTreatmentType. Was extension in STU3" />
      <min value="1" />
      <binding>
        <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName">
          <valueString value="MedicationRequestCourseOfTherapy" />
        </extension>
        <strength value="required" />
        <valueSet value="https://fhir.nhs.uk/R4/ValueSet/eps-prescription-therapy-type" />
      </binding>
    </element>
    <element id="MedicationRequest.courseOfTherapyType.coding">
      <path value="MedicationRequest.courseOfTherapyType.coding" />
      <binding>
        <strength value="required" />
        <description value="Valid Prescription Treatment Types for EPS" />
        <valueSet value="https://fhir.nhs.uk/R4/ValueSet/eps-careconnect-prescription-type" />
      </binding>
    </element>
    <element id="MedicationRequest.dosageInstruction.text">
      <path value="MedicationRequest.dosageInstruction.text" />
      <comment value="ITK Mapping = pertinentInformation2.pertinentLineItem.pertinentInformation2.pertinentDosageInstructions.value" />
    </element>
    <element id="MedicationRequest.dispenseRequest">
      <path value="MedicationRequest.dispenseRequest" />
      <comment value="ITK Mapping = pertinentInformation2.pertinentLineItem.component.lineItemQuantity" />
    </element>
    <element id="MedicationRequest.dispenseRequest.extension">
      <path value="MedicationRequest.dispenseRequest.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
    </element>
    <element id="MedicationRequest.dispenseRequest.extension:performerType">
      <path value="MedicationRequest.dispenseRequest.extension" />
      <sliceName value="performerType" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/R4/StructureDefinition/Extension-performerType" />
      </type>
    </element>
    <element id="MedicationRequest.substitution">
      <path value="MedicationRequest.substitution" />
      <comment value="Substituition is a mandatory requirement for EPS." />
      <min value="1" />
    </element>
    <element id="MedicationRequest.substitution.allowed[x]">
      <path value="MedicationRequest.substitution.allowed[x]" />
      <type>
        <code value="boolean" />
      </type>
    </element>
  </differential>
</StructureDefinition>